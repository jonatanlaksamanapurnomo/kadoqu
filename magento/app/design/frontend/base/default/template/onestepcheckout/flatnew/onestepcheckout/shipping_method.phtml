<?php
/**
 * Magestore
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Magestore.com license that is
 * available through the world-wide-web at this URL:
 * http://www.magestore.com/license-agreement.html
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade this extension to newer
 * version in the future.
 *
 * @category    Magestore
 * @package     Magestore_Onestepcheckout
 * @copyright   Copyright (c) 2017 Magestore (http://www.magestore.com/)
 * @license     http://www.magestore.com/license-agreement.html
 */
?>
<?php

$smcode = Mage::getSingleton('checkout/session')->getQuote()->getShippingAddress()->getShippingMethod();
if (!($_shippingRateGroups = $this->getShippingRates())): ?>
    <p><?php echo $this->__('Sorry, no quotes are available for this order at this time.') ?></p>
<?php else: ?>
    <?php $i = 0; ?>
    <dl class="sp-methods">
        <?php $_sole = count($_shippingRateGroups) == 1;
        foreach ($_shippingRateGroups as $code => $_rates): ?>
            <?php $i++; ?>
            <dt><?php echo $this->getCarrierName($code) ?></dt>
            <dd>
                <ul>
                    <?php $j = 0; ?>
                    <?php $_sole = $_sole && count($_rates) == 1;
                    foreach ($_rates as $_rate): ?>
                        <?php $j++; ?>
                        <li>
                            <?php if ($_rate->getErrorMessage()): ?>
                                <ul class="messages">
                                    <li class="error-msg">
                                        <ul>
                                            <li><?php echo $_rate->getErrorMessage() ?></li>
                                        </ul>
                                    </li>
                                </ul>
                            <?php else: ?>
                                <?php if ($_sole) : ?>
                                    <span class="no-display"><input class="validate-one-required-by-name"
                                                                    name="shipping_method" type="radio"
                                                                    value="<?php echo $_rate->getCode() ?>"
                                                                    id="s_method_<?php echo $_rate->getCode() ?>"
                                                                    checked="checked"
                                                                    onclick="save_shipping_method(shipping_method_url, update_shipping_payment, update_shipping_review);"/></span>
                                <?php else: ?>
                                    <?php if ($i != count($_shippingRateGroups) || $j != count($_rates)): ?>
                                        <style type="text/css">
                                            #advice-validate-one-required-by-name-s_method_<?php echo$_rate->getCode()?> {
                                                display: none !important;
                                            }
                                        </style>
                                    <?php endif; ?>
                                    <input name="shipping_method" type="radio" value="<?php echo $_rate->getCode() ?>"
                                           id="s_method_<?php echo $_rate->getCode() ?>"<?php if (($smcode == null && $j == 1 && $code === Mage::getStoreConfig('onestepcheckout/general/default_shipping', Mage::app()->getStore()->getStoreId())) || ($smcode != null && $_rate->getCode() == $smcode)) echo ' checked="checked"'; ?>
                                           class="radio validate-one-required-by-name"
                                           onclick="save_shipping_method(shipping_method_url, update_shipping_payment, update_shipping_review);"/>
                                <?php endif; ?>
                                <label for="s_method_<?php echo $_rate->getCode() ?>"><?php echo $_rate->getMethodTitle() ?>
                                    <?php $_excl = $this->getShippingPrice($_rate->getPrice(), $this->helper('tax')->displayShippingPriceIncludingTax()); ?>
                                    <?php $_incl = $this->getShippingPrice($_rate->getPrice(), true); ?>
                                    <?php echo $_excl; ?>
                                    <?php if ($this->helper('tax')->displayShippingBothPrices() && $_incl != $_excl): ?>
                                        (<?php echo $this->__('Incl. Tax'); ?><?php echo $_incl; ?>)
                                    <?php endif; ?>
                                </label>
                            <?php endif ?>
                        </li>
                    <?php endforeach; ?>
                </ul>
            </dd>
        <?php endforeach; ?>
        <?php echo $this->getLayout()->createBlock('checkout/onepage_shipping_method_available')->setTemplate('onestepcheckout/page/giftmessage.phtml')->tohtml(); ?>
    </dl>
<?php endif; ?>